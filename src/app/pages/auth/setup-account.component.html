<div class="setup-container fade-in">
  
  <div class="setup-card">

    <div *ngIf="isLoading && !isSuccess" class="state-box">
      <div class="spinner"></div>
      <p>Processando...</p>
    </div>

    <div *ngIf="errorMessage" class="state-box error">
      <div class="icon-circle red">âœ•</div>
      <h3>Link InvÃ¡lido</h3>
      <p>{{ errorMessage }}</p>
      <button (click)="goToLogin()" class="btn-outline">Voltar ao Login</button>
    </div>

    <div *ngIf="isValidToken && !isLoading && !isSuccess">
      <div class="header">
        <div class="logo-area">ðŸ‘‹</div>
        <h1>Bem-vindo(a)!</h1>
        <p>VocÃª foi convidado(a) como <br><strong>{{ invitedEmail }}</strong></p>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        
        <div class="form-group">
          <label>Nome Completo</label>
          <input type="text" formControlName="name" class="modern-input" placeholder="Ex: Maria Silva">
        </div>

        <div class="form-group">
          <label>Telefone (Opcional)</label>
          <input type="tel" formControlName="phone" class="modern-input" placeholder="(11) 99999-9999" maxlength="15">
        </div>

        <div class="form-group">
          <label>Senha</label>
          <div class="password-wrapper">
            <input [type]="showPassword ? 'text' : 'password'" formControlName="password" class="modern-input" placeholder="Crie sua senha">
            <button type="button" class="eye-btn" (click)="togglePassword()">
              <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
            </button>
          </div>
          
          <div class="password-strength" *ngIf="form.get('password')?.value">
            <div class="bars">
              <span class="bar" [class.filled]="passwordStrength >= 1" [class.weak]="passwordStrength === 1" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength === 3"></span>
              <span class="bar" [class.filled]="passwordStrength >= 2" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength === 3"></span>
              <span class="bar" [class.filled]="passwordStrength >= 3" [class.strong]="passwordStrength === 3"></span>
            </div>
            <span class="strength-text">
              {{ passwordStrength === 1 ? 'Fraca' : passwordStrength === 2 ? 'MÃ©dia' : passwordStrength === 3 ? 'Forte' : 'Muito curta' }}
            </span>
          </div>
        </div>

        <div class="form-group">
          <label>Confirmar Senha</label>
          <div class="password-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword" class="modern-input" placeholder="Repita a senha">
            <button type="button" class="eye-btn" (click)="toggleConfirmPassword()">
              <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
            </button>
          </div>
        </div>

        <button type="submit" class="btn-primary full-width" [disabled]="form.invalid || isLoading">
          Finalizar Cadastro
        </button>

      </form>
    </div>

    <div *ngIf="isSuccess" class="success-view fade-in-up">
      <div class="success-checkmark-anim">
        <div class="check-icon">
          <span class="icon-line line-tip"></span>
          <span class="icon-line line-long"></span>
          <div class="icon-circle"></div>
          <div class="icon-fix"></div>
        </div>
      </div>

      <h2>Conta Criada!</h2>
      <p>Seu cadastro foi concluÃ­do com sucesso.<br>Agora vocÃª jÃ¡ pode acessar o sistema.</p>

      <button (click)="goToLogin()" class="btn-primary full-width">
        Ir para Login
      </button>
    </div>

  </div>
  
  <div class="footer-copy">
    Â© 2026 Barbearia Online
  </div>
</div>