<div class="setup-container fade-in">
  <div class="setup-card">

    <div *ngIf="isLoading && !isSuccess && !isValidToken" class="state-box">
      <div class="spinner"></div>
      <p>Validando convite...</p>
    </div>

    <div *ngIf="isLoading && !isSuccess && isValidToken" class="state-box">
      <div class="spinner"></div>
      <p>Criando sua conta...</p>
    </div>

    <div *ngIf="globalErrorMessage" class="state-box error">
      <div class="icon-circle red">‚úï</div>
      <h3>Link Inv√°lido</h3>
      <p>{{ globalErrorMessage }}</p>
      <button (click)="goToLogin()" class="btn-outline">Ir para Login</button>
    </div>

    <div *ngIf="isValidToken && !isLoading && !isSuccess">
      <div class="header">
        <div class="logo-area">üëã</div>
        <h1>Bem-vindo(a)!</h1>
        <p>Voc√™ foi convidado(a) como <br><strong>{{ invitedEmail }}</strong></p>
      </div>

      <div class="alert-error-box fade-in" *ngIf="submissionError">
         <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
         </div>
         <span>{{ submissionError }}</span>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        
        <div class="form-group">
          <label>Nome Completo</label>
          <input type="text" formControlName="name" class="modern-input" placeholder="Ex: Maria Silva"
                 [class.input-error]="form.get('name')?.invalid && form.get('name')?.touched">
          
          <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="field-error">
             O nome √© obrigat√≥rio (m√≠nimo 3 letras).
          </div>
        </div>

        <div class="form-group">
          <label>Telefone (Opcional)</label>
          <input type="tel" formControlName="phone" class="modern-input" placeholder="(11) 99999-9999" maxlength="15"
                 [class.input-error]="form.get('phone')?.invalid && form.get('phone')?.touched">
          <div *ngIf="form.get('phone')?.invalid && form.get('phone')?.touched" class="field-error">
             Formato inv√°lido.
          </div>
        </div>

        <div class="form-group">
          <label>Senha</label>
          <div class="password-wrapper">
            <input [type]="showPassword ? 'text' : 'password'" formControlName="password" class="modern-input" placeholder="M√≠n. 6 caracteres + n√∫mero"
                   [class.input-error]="form.get('password')?.invalid && form.get('password')?.touched">
            <button type="button" class="eye-btn" (click)="togglePassword()">
              <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
            </button>
          </div>
          
          <ng-container *ngIf="form.get('password')?.touched">
            <div *ngIf="form.get('password')?.errors?.['required']" class="field-error">Senha obrigat√≥ria.</div>
            <div *ngIf="form.get('password')?.errors?.['minlength']" class="field-error">M√≠nimo 6 caracteres.</div>
            <div *ngIf="form.get('password')?.errors?.['noNumber']" class="field-error">Deve conter um n√∫mero.</div>
          </ng-container>

          <div class="password-strength" *ngIf="form.get('password')?.value">
            <div class="bars">
              <span class="bar" [class.filled]="passwordStrength >= 1" [class.weak]="passwordStrength === 1" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength === 3"></span>
              <span class="bar" [class.filled]="passwordStrength >= 2" [class.medium]="passwordStrength === 2" [class.strong]="passwordStrength === 3"></span>
              <span class="bar" [class.filled]="passwordStrength >= 3" [class.strong]="passwordStrength === 3"></span>
            </div>
            <span class="strength-text">
              {{ passwordStrength === 1 ? 'Fraca' : passwordStrength === 2 ? 'M√©dia' : passwordStrength === 3 ? 'Forte' : 'Curta' }}
            </span>
          </div>
        </div>

        <div class="form-group">
          <label>Confirmar Senha</label>
          <div class="password-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword" class="modern-input" placeholder="Repita a senha"
                   [class.input-error]="form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched">
            <button type="button" class="eye-btn" (click)="toggleConfirmPassword()">
               <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
               <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
            </button>
          </div>
          <div *ngIf="form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched" class="field-error">
             Confirma√ß√£o obrigat√≥ria.
          </div>
        </div>

        <button type="submit" class="btn-primary full-width" [disabled]="isLoading">
          Finalizar Cadastro
        </button>

      </form>
    </div>

    <div *ngIf="isSuccess" class="success-view fade-in-up">
      <div class="animation-container">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
        </svg>
      </div>

      <h2 class="success-title">Conta Criada!</h2>
      <p class="success-msg">Seu cadastro foi conclu√≠do com sucesso.<br>Agora voc√™ j√° pode acessar o sistema.</p>

      <button (click)="goToLogin()" class="btn-primary full-width">
        Ir para Login
      </button>
    </div>

  </div>
  
  <div class="footer-copy">
    ¬© 2026 Barbearia Online
  </div>
</div>